# üõí VkusVill Bot

Telegram-–±–æ—Ç –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏ —Å–±–æ—Ä–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã –∏–∑ [–í–∫—É—Å–í–∏–ª–ª](https://vkusvill.ru) —Å –ø–æ–º–æ—â—å—é –ò–ò.

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **GigaChat** (–°–±–µ—Ä) –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ –∏ **MCP-—Å–µ—Ä–≤–µ—Ä –í–∫—É—Å–í–∏–ª–ª** –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ—Ä–∑–∏–Ω.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–£–º–Ω—ã–π –ø–æ–¥–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤** ‚Äî –æ–ø–∏—à–∏, —á—Ç–æ —Ö–æ—á–µ—à—å –∫—É–ø–∏—Ç—å, –∏ –±–æ—Ç –ø–æ–¥–±–µ—Ä—ë—Ç —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ –í–∫—É—Å–í–∏–ª–ª
- **–°–±–æ—Ä–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã** ‚Äî –±–æ—Ç —Å–æ–∑–¥–∞—ë—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –≥–æ—Ç–æ–≤—É—é –∫–æ—Ä–∑–∏–Ω—É —Å —Ä–∞—Å—á—ë—Ç–æ–º —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- **–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** ‚Äî –±–æ—Ç –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –≤–∫—É—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´—è –ª—é–±–ª—é –ø–ª–æ–º–±–∏—Ä –≤ —à–æ–∫–æ–ª–∞–¥–µ¬ª) –∏ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∏—Ö –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞** ‚Äî –±–æ—Ç –ø–æ–º–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –∏ –º–æ–∂–µ—Ç —É—Ç–æ—á–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å
- **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å–µ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –ø–æ–ø–∞–ª–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
- **Rate limiting** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ (5 —Å–æ–æ–±—â–µ–Ω–∏–π / 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞   | –û–ø–∏—Å–∞–Ω–∏–µ                        |
|-----------|---------------------------------|
| `/start`  | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è        |
| `/help`   | –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞               |
| `/reset`  | –°–±—Ä–æ—Å–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞        |

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Telegram (aiogram 3)
    ‚Üì
ThrottlingMiddleware (rate limiting)
    ‚Üì
Handlers (–∫–æ–º–∞–Ω–¥—ã + —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
    ‚Üì
GigaChatService (–ò–ò-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è, function calling)
    ‚îú‚îÄ‚îÄ GigaChat API (–≤—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤)
    ‚îú‚îÄ‚îÄ VkusvillMCPClient (–ø–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ä–∑–∏–Ω–∞)
    ‚îî‚îÄ‚îÄ PreferencesStore (SQLite ‚Äî –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
```

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç           | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è                              |
|---------------------|-----------------------------------------|
| Telegram-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫  | [aiogram 3](https://docs.aiogram.dev/)  |
| –ò–ò-–º–æ–¥–µ–ª—å           | [GigaChat](https://developers.sber.ru/portal/products/gigachat) |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –í–∫—É—Å–í–∏–ª–ª | [MCP](https://modelcontextprotocol.io/) (Model Context Protocol) |
| –•—Ä–∞–Ω–∏–ª–∏—â–µ           | SQLite (aiosqlite)                      |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è        | pydantic-settings                       |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ        | pytest, pytest-asyncio, respx           |
| CI/CD               | GitHub Actions                          |

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python >= 3.11
- [uv](https://docs.astral.sh/uv/) (–º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤)
- Telegram Bot Token ([BotFather](https://t.me/BotFather))
- GigaChat API –∫–ª—é—á ([Sber AI](https://developers.sber.ru/portal/products/gigachat))

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone https://github.com/mrPDA/vkuswill_bot.git
cd vkuswill_bot
uv sync
```

–°–æ–∑–¥–∞–π—Ç–µ `.env` –∏–∑ –ø—Ä–∏–º–µ—Ä–∞:

```bash
cp .env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è             | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ                          | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é               |
|------------------------|:------------:|-----------------------------------|-----------------------------|
| `BOT_TOKEN`            | –¥–∞           | –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞               | ‚Äî                           |
| `GIGACHAT_CREDENTIALS` | –¥–∞           | –ö–ª—é—á –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ GigaChat         | ‚Äî                           |
| `GIGACHAT_MODEL`       | –Ω–µ—Ç          | –ú–æ–¥–µ–ª—å GigaChat                   | `GigaChat`                  |
| `GIGACHAT_SCOPE`       | –Ω–µ—Ç          | –û–±–ª–∞—Å—Ç—å –¥–æ—Å—Ç—É–ø–∞ GigaChat          | `GIGACHAT_API_PERS`         |
| `MCP_SERVER_URL`       | –Ω–µ—Ç          | URL MCP-—Å–µ—Ä–≤–µ—Ä–∞ –í–∫—É—Å–í–∏–ª–ª          | `https://mcp001.vkusvill.ru/mcp` |
| `MAX_TOOL_CALLS`       | –Ω–µ—Ç          | –ú–∞–∫—Å. –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∑–∞ –∑–∞–ø—Ä–æ—Å | `15`                     |
| `MAX_HISTORY_MESSAGES` | –Ω–µ—Ç          | –ú–∞–∫—Å. —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ | `50`                        |
| `DATABASE_PATH`        | –Ω–µ—Ç          | –ü—É—Ç—å –∫ SQLite-–±–∞–∑–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π   | `data/preferences.db`       |
| `DEBUG`                | –Ω–µ—Ç          | –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏                     | `false`                     |

## –ó–∞–ø—É—Å–∫

```bash
# –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
./run.sh

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
uv run python -m vkuswill_bot

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
./stop.sh
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
vkuswill_bot/
‚îú‚îÄ‚îÄ src/vkuswill_bot/
‚îÇ   ‚îú‚îÄ‚îÄ __main__.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ config.py                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (pydantic-settings)
‚îÇ   ‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers.py          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ middlewares.py       # ThrottlingMiddleware (rate limiting)
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îú‚îÄ‚îÄ gigachat_service.py  # GigaChat + function calling
‚îÇ       ‚îú‚îÄ‚îÄ mcp_client.py        # MCP-–∫–ª–∏–µ–Ω—Ç (JSON-RPC, HTTP keep-alive)
‚îÇ       ‚îî‚îÄ‚îÄ preferences_store.py # –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π (SQLite)
‚îú‚îÄ‚îÄ tests/                       # –¢–µ—Å—Ç—ã (pytest)
‚îÇ   ‚îú‚îÄ‚îÄ test_handlers.py         # –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ test_gigachat_service.py # –¢–µ—Å—Ç—ã GigaChat-—Å–µ—Ä–≤–∏—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ test_mcp_client.py       # –¢–µ—Å—Ç—ã MCP-–∫–ª–∏–µ–Ω—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ test_preferences_store.py# –¢–µ—Å—Ç—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ test_middlewares.py      # –¢–µ—Å—Ç—ã rate limiting
‚îÇ   ‚îú‚îÄ‚îÄ test_security_sast.py    # SAST: —Å–µ–∫—Ä–µ—Ç—ã, –æ–ø–∞—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, SSL
‚îÇ   ‚îú‚îÄ‚îÄ test_ai_safety.py        # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ò–ò: prompt injection, jailbreak
‚îÇ   ‚îú‚îÄ‚îÄ test_config_security.py  # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ test_input_validation.py # –í–∞–ª–∏–¥–∞—Ü–∏—è: Unicode, XSS, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îú‚îÄ‚îÄ ci.yml               # CI: —Ç–µ—Å—Ç—ã, –ª–∏–Ω—Ç–µ—Ä, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚îÇ       ‚îî‚îÄ‚îÄ release.yml          # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–ª–∏–∑ –ø–æ —Ç–µ–≥—É
‚îú‚îÄ‚îÄ .githooks/
‚îÇ   ‚îú‚îÄ‚îÄ commit-msg               # –í–∞–ª–∏–¥–∞—Ü–∏—è Conventional Commits
‚îÇ   ‚îî‚îÄ‚îÄ pre-push                 # –¢–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ push
‚îú‚îÄ‚îÄ Makefile                     # –£—Ç–∏–ª–∏—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ pyproject.toml               # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .env.example                 # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ run.sh                       # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îî‚îÄ‚îÄ stop.sh                      # –°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
make test              # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
make test-cov          # –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
make test-security     # –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (SAST, AI safety, config)
make lint              # –ü—Ä–æ–≤–µ—Ä–∫–∞ ruff
make format            # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ruff
```

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤

- **–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã** ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, GigaChat-—Å–µ—Ä–≤–∏—Å, MCP-–∫–ª–∏–µ–Ω—Ç, —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π, middleware
- **SAST** ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑: –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã, –æ–ø–∞—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, SSL, —É—Ç–µ—á–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- **AI Safety** ‚Äî prompt injection, jailbreak, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞, –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
- **Config Security** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–µ—Ñ–æ–ª—Ç—ã, –∑–∞—â–∏—Ç–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤
- **Input Validation** ‚Äî Unicode-–∞—Ç–∞–∫–∏, XSS, SQL injection, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã, –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏

## CI/CD

- **ci.yml** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ push/PR –≤ main: —Ç–µ—Å—Ç—ã (Python 3.11‚Äì3.13), ruff, security checks, –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–º–∏—Ç–æ–≤
- **release.yml** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —Ç–µ–≥—É `v*.*.*`: —Ç–µ—Å—Ç—ã, –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏, —Å–æ–∑–¥–∞–Ω–∏–µ GitHub Release

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
